---
name: dqx
description: Data Quality Framework for PySpark Workloads
install:
  script: src/databricks/labs/dqx/installer/install.py
  extras: cli
uninstall:
  script: src/databricks/labs/dqx/installer/uninstall.py
entrypoint: src/databricks/labs/dqx/cli.py
min_python: 3.10
commands:
  - name: open-remote-config
    description: Opens remote configuration in the browser.
  - name: open-dashboards
    description: Opens remote dashboards directory.
  - name: installations
    description: Show installations by different users on the same workspace.
    table_template: |-
      Path\tVersion\Input
      {{range .}}{{.path}}\t{{.version}}\t{{.input}}
      {{end}}
  - name: validate-checks
    description: Validate checks
    flags:
      - name: run-config
        description: Run config to use. If not provided, run it for all run configs.
      - name: validate-custom-check-functions
        description: Whether to validate custom check functions.
        default: true
    table_template: |-
      Run Config\tErrors
      {{range .}}{{.run_config}}\t{{.error}}
      {{end}}
  - name: profile
    description: Profile input data and generate quality rule (checks) candidates.
    flags:
      - name: run-config
        description: (Optional) Selects run configuration from installation config. If not provided, run it for all run configurations.
      - name: patterns
        description: (Optional) Semicolon separated list of location patterns to profile. If provided, location fields in the run config are ignored. Requires a run config to be provided which is used as a template for other fields.
      - name: exclude-patterns
        description: (Optional) Semicolon separated list of location patterns to exclude from profiling. Useful if wanting to exclude existing output tables.
      - name: timeout-minutes
        description: The timeout in minutes for the cli to wait for the workflow to complete.
  - name: apply-checks
    description: Apply data quality checks to the input data, and save the results to the output table and optionally quarantine table (based on the run config).
    flags:
      - name: run-config
        description: (Optional) Selects run configuration from installation config. If not provided, run it for all run configurations.
      - name: patterns
        description: (Optional) Semicolon separated list of location patterns to use. If provided, location fields in the run config are ignored. Requires a run config to be provided which is used as a template for other fields.
      - name: exclude-patterns
        description: (Optional) Semicolon separated list of location patterns to exclude from profiling. Useful if wanting to exclude existing output tables.
      - name: output-table-suffix
        description: (Optional) Suffix to append to the output table name.
        default: "_dq_output"
      - name: quarantine-table-suffix
        description: (Optional) Suffix to append to the quarantine table name.
        default: "_dq_quarantine"
      - name: timeout-minutes
        description: The timeout in minutes for the cli to wait for the workflow to complete.
  - name: e2e
    description: Run end to end workflow to profile input data and apply quality checks, and save the results to the output table and optionally quarantine table (based on the run config).
    flags:
      - name: run-config
        description: (Optional) Selects run configuration from installation config. If not provided, run it for all run configurations.
      - name: patterns
        description: (Optional) Semicolon separated list of location patterns to use. If provided, location fields in the run config are ignored. Requires a run config to be provided which is used as a template for other fields.
      - name: exclude-patterns
        description: (Optional) Semicolon separated list of location patterns to exclude from profiling. Useful if wanting to exclude existing output tables.
      - name: output-table-suffix
        description: (Optional) Suffix to append to the output table name.
        default: "_dq_output"
      - name: quarantine-table-suffix
        description: (Optional) Suffix to append to the quarantine table name.
        default: "_dq_quarantine"
      - name: timeout-minutes
        description: The timeout in minutes for the cli to wait for the workflow to complete.
  - name: workflows
    description: Show deployed workflows and their latest run state.
    table_template: |-
      Workflow\tWorkflow ID\tState\tStarted
      {{range .}}{{.workflow}}\t{{.workflow_id}}\t{{.state}}\t{{.started}}
      {{end}}
  - name: logs
    description: Show logs from the latest job run
    flags:
      - name: workflow
        description: Name of the workflow to show logs for, e.g. profiler.